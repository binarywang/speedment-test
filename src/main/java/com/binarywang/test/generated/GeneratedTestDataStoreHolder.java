package com.binarywang.test.generated;

import com.binarywang.test.test.test.order_info.OrderInfo;
import com.binarywang.test.test.test.order_info.generated.GeneratedOrderInfoCacheHolder;
import com.binarywang.test.test.test.user_info.UserInfo;
import com.binarywang.test.test.test.user_info.generated.GeneratedUserInfoCacheHolder;
import com.speedment.common.annotation.GeneratedCode;
import com.speedment.enterprise.datastore.runtime.DataStoreHolder;
import com.speedment.enterprise.datastore.runtime.HasStatistics.Statistics;
import com.speedment.enterprise.datastore.runtime.entitystore.EntityStore;
import com.speedment.enterprise.datastore.runtime.entitystore.EntityStoreHolder;
import com.speedment.enterprise.datastore.runtime.fieldcache.FieldCache;
import com.speedment.enterprise.datastore.runtime.fieldcache.MultiFieldCache;
import com.speedment.enterprise.datastore.runtime.util.StatisticsUtil;
import com.speedment.runtime.config.identifier.ColumnIdentifier;

import java.util.Map;
import java.util.Optional;
import java.util.stream.Stream;

import static java.util.Objects.requireNonNull;

/**
 * A holder class for the various caches that are used to speed up the project.
 * <p>
 * This file has been automatically generated by Speedment. Any changes made to
 * it will be overwritten.
 * 
 * @author Speedment
 */
@GeneratedCode("Speedment")
public final class GeneratedTestDataStoreHolder implements DataStoreHolder {
    
    private final GeneratedOrderInfoCacheHolder orderInfoHolder;
    private final GeneratedUserInfoCacheHolder userInfoHolder;
    
    public GeneratedTestDataStoreHolder(GeneratedOrderInfoCacheHolder orderInfoHolder, GeneratedUserInfoCacheHolder userInfoHolder) {
        this.orderInfoHolder = requireNonNull(orderInfoHolder);
        this.userInfoHolder  = requireNonNull(userInfoHolder);
    }
    
    @Override
    @SuppressWarnings("unchecked")
    public <ENTITY> EntityStore<ENTITY> getEntityStore(
            String dbmsName,
            String schemaName,
            String tableName) {
        if ("order_info".equals(tableName)) {
            return (EntityStore<ENTITY>) orderInfoHolder.getEntityStore();
        } else {
            return (EntityStore<ENTITY>) userInfoHolder.getEntityStore();
        }
    }
    
    @Override
    @SuppressWarnings("unchecked")
    public <ENTITY, CACHE extends FieldCache<CACHE>> CACHE getFieldCache(ColumnIdentifier<ENTITY> columnId) {
        if ("order_info".equals(columnId.getTableId())) {
            return (CACHE) orderInfoHolder.getFieldCache((ColumnIdentifier<OrderInfo>) columnId);
        } else {
            return (CACHE) userInfoHolder.getFieldCache((ColumnIdentifier<UserInfo>) columnId);
        }
    }
    
    @Override
    @SuppressWarnings("unchecked")
    public <ENTITY, T0, T1, CACHE extends MultiFieldCache<T0, T1, CACHE>> Optional<CACHE> getMultiFieldCache(ColumnIdentifier<ENTITY> firstColumnId, ColumnIdentifier<ENTITY> secondColumnId) {
        return Optional.empty(); // No multi-indexes are used in the project
    }
    
    @Override
    @SuppressWarnings("unchecked")
    public <ENTITY> boolean isHavingMultiFieldCache(ColumnIdentifier<ENTITY> columnId) {
        return false; // No multi-indexes are used in the project
    }
    
    @Override
    public void close() {
        holders().forEach(EntityStoreHolder::close);
    }
    
    @Override
    public Map<String, Map<Statistics, ?>> getStatistics() {
        return StatisticsUtil.create(
            holders()
                .toArray(EntityStoreHolder[]::new)
        );
    }
    
    @Override
    public Stream<EntityStoreHolder<?>> holders() {
        return Stream.of(
            orderInfoHolder,
            userInfoHolder
        );
    }
}